// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.25.0
// source: campaigns.sql

package repo

import (
	"context"
	"database/sql"

	"github.com/google/uuid"
)

const changeValid = `-- name: ChangeValid :exec
UPDATE
    t_campaigns
SET
    is_valid = COALESCE($1, is_valid)
WHERE
    id = $2
`

type ChangeValidParams struct {
	IsValid    bool
	CampaignID uuid.UUID
}

func (q *Queries) ChangeValid(ctx context.Context, arg ChangeValidParams) error {
	_, err := q.db.ExecContext(ctx, changeValid, arg.IsValid, arg.CampaignID)
	return err
}

const changeVerified = `-- name: ChangeVerified :exec
UPDATE
    t_campaigns
SET
    is_verified = COALESCE($1, is_verified)
WHERE
    id = $2
`

type ChangeVerifiedParams struct {
	IsVerified bool
	CampaignID uuid.UUID
}

func (q *Queries) ChangeVerified(ctx context.Context, arg ChangeVerifiedParams) error {
	_, err := q.db.ExecContext(ctx, changeVerified, arg.IsVerified, arg.CampaignID)
	return err
}

const countCampaigns = `-- name: CountCampaigns :one
SELECT 
    COUNT(*) 
FROM 
    t_campaigns 
WHERE 
    ($1::UUID IS NULL OR user_id = $1::UUID)
    AND is_valid = FALSE
`

func (q *Queries) CountCampaigns(ctx context.Context, userID uuid.NullUUID) (int64, error) {
	row := q.db.QueryRowContext(ctx, countCampaigns, userID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createCampaign = `-- name: CreateCampaign :one
INSERT INTO t_campaigns 
    (user_id, wallet_address, title, description, image_path, target_amount, raised_amount, status_type, start_date, end_date, created_at)
VALUES 
    ($1, $2, $3, $4, $5, $6, DEFAULT, $7, $8, $9, NOW())
RETURNING id
`

type CreateCampaignParams struct {
	UserID        uuid.UUID
	WalletAddress string
	Title         string
	Description   sql.NullString
	ImagePath     sql.NullString
	TargetAmount  string
	StatusType    string
	StartDate     sql.NullTime
	EndDate       sql.NullTime
}

func (q *Queries) CreateCampaign(ctx context.Context, arg CreateCampaignParams) (uuid.UUID, error) {
	row := q.db.QueryRowContext(ctx, createCampaign,
		arg.UserID,
		arg.WalletAddress,
		arg.Title,
		arg.Description,
		arg.ImagePath,
		arg.TargetAmount,
		arg.StatusType,
		arg.StartDate,
		arg.EndDate,
	)
	var id uuid.UUID
	err := row.Scan(&id)
	return id, err
}

const deleteCampaign = `-- name: DeleteCampaign :exec
DELETE FROM 
    t_campaigns
WHERE
    id = $1
`

func (q *Queries) DeleteCampaign(ctx context.Context, campaignID uuid.UUID) error {
	_, err := q.db.ExecContext(ctx, deleteCampaign, campaignID)
	return err
}

const getCampaignByID = `-- name: GetCampaignByID :one
SELECT 
    id, user_id, title, description, wallet_address, image_path, target_amount, raised_amount, 
    accepted_token_symbol, is_verified, is_valid, status_type, start_date, end_date, created_at
FROM 
    t_campaigns
WHERE 
    id = $1
`

func (q *Queries) GetCampaignByID(ctx context.Context, campaignID uuid.UUID) (TCampaign, error) {
	row := q.db.QueryRowContext(ctx, getCampaignByID, campaignID)
	var i TCampaign
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.Title,
		&i.Description,
		&i.WalletAddress,
		&i.ImagePath,
		&i.TargetAmount,
		&i.RaisedAmount,
		&i.AcceptedTokenSymbol,
		&i.IsVerified,
		&i.IsValid,
		&i.StatusType,
		&i.StartDate,
		&i.EndDate,
		&i.CreatedAt,
	)
	return i, err
}

const getCampaigns = `-- name: GetCampaigns :many
SELECT 
    id, user_id, title, description, wallet_address, image_path, target_amount, raised_amount, 
    accepted_token_symbol, is_verified, is_valid, status_type, start_date, end_date, created_at
FROM 
    t_campaigns
WHERE
    ($1::UUID IS NULL OR id = $1::UUID) AND
    ($2::UUID IS NULL OR user_id = $2::UUID) AND
    ($3::BOOLEAN IS NULL OR is_verified = $3::BOOLEAN) AND
    ($4::TEXT IS NULL OR status_type = $4::TEXT) AND
    is_valid = FALSE
LIMIT $6 OFFSET $5
`

type GetCampaignsParams struct {
	ID         uuid.NullUUID
	UserID     uuid.NullUUID
	IsVerified sql.NullBool
	StatusType sql.NullString
	Off        int32
	Lim        int32
}

func (q *Queries) GetCampaigns(ctx context.Context, arg GetCampaignsParams) ([]TCampaign, error) {
	rows, err := q.db.QueryContext(ctx, getCampaigns,
		arg.ID,
		arg.UserID,
		arg.IsVerified,
		arg.StatusType,
		arg.Off,
		arg.Lim,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []TCampaign
	for rows.Next() {
		var i TCampaign
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.Title,
			&i.Description,
			&i.WalletAddress,
			&i.ImagePath,
			&i.TargetAmount,
			&i.RaisedAmount,
			&i.AcceptedTokenSymbol,
			&i.IsVerified,
			&i.IsValid,
			&i.StatusType,
			&i.StartDate,
			&i.EndDate,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getUserCampaign = `-- name: GetUserCampaign :one
SELECT 
    id, user_id, title, description, wallet_address, image_path, target_amount, raised_amount, 
    accepted_token_symbol, is_verified, is_valid, status_type, start_date, end_date, created_at
FROM 
    t_campaigns
WHERE 
    id = $1 AND user_id = $2
`

type GetUserCampaignParams struct {
	CampaignID uuid.UUID
	UserID     uuid.UUID
}

func (q *Queries) GetUserCampaign(ctx context.Context, arg GetUserCampaignParams) (TCampaign, error) {
	row := q.db.QueryRowContext(ctx, getUserCampaign, arg.CampaignID, arg.UserID)
	var i TCampaign
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.Title,
		&i.Description,
		&i.WalletAddress,
		&i.ImagePath,
		&i.TargetAmount,
		&i.RaisedAmount,
		&i.AcceptedTokenSymbol,
		&i.IsVerified,
		&i.IsValid,
		&i.StatusType,
		&i.StartDate,
		&i.EndDate,
		&i.CreatedAt,
	)
	return i, err
}

const updateCampaign = `-- name: UpdateCampaign :exec
UPDATE
    t_campaigns
SET
    wallet_address = COALESCE($1, wallet_address),
    title = COALESCE($2, title),
    description = COALESCE($3, description),
    image_path = COALESCE($4, image_path),
    target_amount = COALESCE($5, target_amount),
    raised_amount = COALESCE($6, raised_amount),
    is_valid = COALESCE($7, is_valid),
    status_type = COALESCE($8, status_type),
    start_date = COALESCE($9, start_date),
    end_date = COALESCE($10, end_date)
WHERE
    id = $11
`

type UpdateCampaignParams struct {
	WalletAddress sql.NullString
	Title         sql.NullString
	Description   sql.NullString
	ImagePath     sql.NullString
	TargetAmount  sql.NullString
	RaisedAmount  sql.NullString
	IsValid       sql.NullBool
	StatusType    sql.NullString
	StartDate     sql.NullTime
	EndDate       sql.NullTime
	CampaignID    uuid.UUID
}

func (q *Queries) UpdateCampaign(ctx context.Context, arg UpdateCampaignParams) error {
	_, err := q.db.ExecContext(ctx, updateCampaign,
		arg.WalletAddress,
		arg.Title,
		arg.Description,
		arg.ImagePath,
		arg.TargetAmount,
		arg.RaisedAmount,
		arg.IsValid,
		arg.StatusType,
		arg.StartDate,
		arg.EndDate,
		arg.CampaignID,
	)
	return err
}
